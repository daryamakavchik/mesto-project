(()=>{"use strict";var e="5f538871-a93e-462d-87c2-0ed817fe3122",t=function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))};function n(e){e.classList.add("popup_opened"),document.addEventListener("keydown",r)}function o(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",r)}function r(e){"Escape"===e.key&&o(document.querySelector(".popup_opened"))}var c=document.querySelector(".profile__title"),i=document.querySelector(".profile__subtitle"),u=document.querySelector("#username"),a=document.querySelector("#usernameinfo"),s=document.querySelector("#imagelink"),l=document.querySelector("#placename"),d=document.querySelector("#profilepicture"),m=document.querySelector(".popup__profile"),p=document.querySelector(".popup__add-card"),f=document.querySelector(".popup-image"),y=document.querySelector("#profilesubmitbutton"),v=document.querySelector("#addcardbutton"),_=document.querySelector("#profilepicsubmitbutton"),h=document.querySelector("#addcardform"),S=document.querySelector(".popup-profilepic");function b(e,t){t.textContent=e?"Сохранение...":t===v?"Создать":"Сохранить"}var q=document.querySelector("#cardtemplate").content,E=document.querySelector(".popup-image__image"),L=document.querySelector(".popup-image__caption");function C(o,r,c,i,u,a){var s=q.querySelector(".elements__element").cloneNode(!0),l=s.querySelector(".elements__image"),d=s.querySelector(".elements__delete-button"),m=s.querySelector(".elements__icon"),p=s.querySelector(".elements__icon-likes"),y=s.querySelector(".elements__text");return l.alt=o,l.src=r,y.textContent=o,p.textContent="".concat(u.length),u.some((function(e){return e._id===a}))&&m.classList.add("elements__icon_active"),i===a?(d.style.display="block",d.addEventListener("click",(function(t){t.target.closest(".elements__element").remove(),function(t){fetch("https://nomoreparties.co/v1/plus-cohort-8/cards/".concat(t),{method:"DELETE",headers:{authorization:e}})}(c)}))):d.style.display="none",l.addEventListener("click",(function(){E.alt=o,E.src=l.src,L.textContent=o,n(f)})),m.addEventListener("click",(function(){var n=u.find((function(e){return e._id===a}));(function(n,o){return fetch("https://nomoreparties.co/v1/plus-cohort-8/cards/likes/".concat(n),{method:o,headers:{authorization:e}}).then(t)})(c,void 0!==n?"DELETE":"PUT").then((function(e){u=e.likes,p.textContent="".concat(u.length),u.some((function(e){return e._id===a}))?m.classList.add("elements__icon_active"):m.classList.remove("elements__icon_active")}))})),s}function g(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}var k,x=document.querySelector(".elements"),A=document.querySelector(".profile__image"),T=function(e){console.log(e)},j=function(n){fetch("https://nomoreparties.co/v1/plus-cohort-8/cards",{method:"GET",headers:{authorization:e}}).then(t).then((function(e){return e.map((function(e){return C(e.name,e.link,e._id,e.owner._id,e.likes,n)}))})).then((function(e){var t;x.prepend.apply(x,function(e){if(Array.isArray(e))return g(e)}(t=e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(t)||function(e,t){if(e){if("string"==typeof e)return g(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?g(e,t):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())})).catch(T)},w=function(e,t,n){t.validity.valid?B(e,t,n):O(e,t,t.validationMessage,n)},z=function(e,t,n){D(e)?(t.classList.add(n.inactiveButtonClass),t.disabled=!0):(t.classList.remove(n.inactiveButtonClass),t.disabled=!1)},D=function(e){return e.some((function(e){return!e.validity.valid}))},O=function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o.inputErrorClass),r.textContent=n,r.classList.add(o.errorClass)},B=function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),o.classList.remove(n.errorClass),o.textContent=""},P=document.querySelectorAll(".popup"),N=document.querySelector("#profileform"),I=document.querySelector(".profile__edit-button"),J=document.querySelector("#addcardform"),G=document.querySelector(".profile__add-button"),H=document.querySelector("#profilepicform"),M=document.querySelector("#editprofilepicbutton");fetch("https://nomoreparties.co/v1/plus-cohort-8/users/me",{method:"GET",headers:{authorization:e}}).then(t).then((function(e){c.textContent=e.name,i.textContent=e.about,A.src=e.avatar;var t=e._id;j(t)})).catch(T),k={formSelector:".form",inputSelector:".form__input",submitButtonSelector:".form__button-submit",inputErrorClass:"form__input_type_error",errorClass:"form__input-error_active",inactiveButtonClass:"form__button-submit_disabled"},Array.from(document.querySelectorAll(k.formSelector)).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);z(n,o,t),n.forEach((function(r){r.addEventListener("input",(function(){w(e,r,t),z(n,o,t)}))}))}(e,k)})),P.forEach((function(e){e.addEventListener("mousedown",(function(t){t.target.classList.contains("popup_opened")&&o(e),t.target.classList.contains("popup__close")&&o(e)}))})),N.addEventListener("submit",(function(n){n.preventDefault(),b(!0,y),c.textContent=u.value,i.textContent=a.value,function(n,o){var r,c;(r=n,c=o,fetch("https://nomoreparties.co/v1/plus-cohort-8/users/me",{method:"PATCH",headers:{authorization:e,"Content-Type":"application/json"},body:JSON.stringify({name:r,about:c})}).then(t)).finally((function(){return b(!1,y)}))}(u.value,a.value),o(m)})),I.addEventListener("click",(function(){u.value=c.textContent,a.value=i.textContent,n(m)})),J.addEventListener("submit",(function(n){var r,c;n.preventDefault(),b(!0,v),r=l.value,c=s.value,function(n,o){return fetch("https://nomoreparties.co/v1/plus-cohort-8/cards",{method:"POST",headers:{authorization:e,"Content-Type":"application/json"},body:JSON.stringify({name:n,link:"".concat(o)})}).then(t)}(r,c).then((function(e){return C(e.name,e.link,e._id,e._id,e.likes,e._id)})).then((function(e){x.prepend(e)})).catch(T).finally((function(){return b(!1,v)})),o(p),h.reset(),v.classList.add("form__button-submit_disabled"),v.disabled=!0})),G.addEventListener("click",(function(){n(p)})),H.addEventListener("submit",(function(n){n.preventDefault(),b(!0,_),function(n){return fetch("https://nomoreparties.co/v1/plus-cohort-8/users/me/avatar",{method:"PATCH",headers:{authorization:e,"Content-Type":"application/json"},body:JSON.stringify({avatar:n})}).then(t)}(d.value).then((function(e){A.src=e.avatar})).catch(T).finally((function(){return b(!1,_)})),o(S)})),M.addEventListener("click",(function(){n(S)}))})();